// Backbone.BabySitter, v0.0.4.1
// Primary Copyright (c)2012 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/marionettejs/backbone.babysitter
// Modified fork Copyright (c)2012 Jeremy McLeod, Isochronous.org
(function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone");module.exports=t(n,r)}else typeof define=="function"&&define.amd&&define(["underscore","backbone"],t)})(this,function(e,t){"option strict";return t.ChildViewContainer=function(e,t){var n=window.console,r=function(e,n){this.options=n||(n={}),this._views={},this._indexByModel={},this._indexByCollection={},this._indexByCustom={},this._updateLength(),this.parser=n.parser||this.parser||!1,this.parser=t.isFunction(this.parser)?this.parser:!1,this.customIndexProperty=n.customIndexProperty||this.customIndexProperty,this._addInitialViews(e);var r=n.initialize||this.initialize||!1;r&&r.call(this,n)};t.extend(r.prototype,{customIndexProperty:"customIndex",add:function(t,r){var i=this.parser?this.parser(t):t;if(!i){n.error("Couldn't add view %o: unexpected format",t);return}if(!(i instanceof e.View)){n.error("Cannot add non-view object to container: ",t);return}t=i;var s=t.cid,o=this.customIndexProperty;r=r||t[o]||!1,this._views[s]=t,t.model&&(this._indexByModel[t.model.cid]=s),t.collection&&(this._indexByCollection[t.collection.cid]=s),r&&(this._indexByCustom[r]=s),this._updateLength()},findByModel:function(e){var t=this._indexByModel[e.cid];return this.findByCid(t)},findByCollection:function(e){var t=this._indexByCollection[e.cid];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var t=e.cid;e.model&&delete this._indexByModel[e.model.cid],e.collection&&delete this._indexByCollection[e.collection.cid];var n;for(var r in this._indexByCustom)if(this._indexByCustom.hasOwnProperty(r)&&this._indexByCustom[r]===t){n=r;break}n&&delete this._indexByCustom[n],delete this._views[t],this._updateLength()},call:function(e,t){t=Array.prototype.slice.call(arguments,1),this.apply(e,t)},apply:function(e,n){var r;n=n||[],t.each(this._views,function(r,i){t.isFunction(r[e])&&r[e].apply(r,n)})},_updateLength:function(){this.length=t.size(this._views)},_addInitialViews:function(e){if(!e)return;var t,n,r=e.length;for(n=0;n<r;n++)t=e[n],this.add(t)}});var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(i,function(e){r.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),r}(t,e),t.ChildViewContainer});